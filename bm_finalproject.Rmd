---
title: "bm_finalproject"
author: "Coco"
date: "12/7/2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(multcomp)
library(faraway) 
library(ggplot2)
library(patchwork)
library("leaps")
library(caret)
library(dplyr)
```

##Read data

```{r include = FALSE}
 cancer_df <- read.csv(file = "./data/Cancer_Registry.csv") %>% 
   janitor::clean_names() %>% 
   separate(geography, into = c("county", "state"),sep = ",") %>% 
   separate(binned_inc, into = c("binned_inc_low","binned_inc_high"), sep = ",") %>% 
   mutate(binned_inc_low = str_replace(binned_inc_low,"[(]",""),
          binned_inc_high = str_replace(binned_inc_high,"[]]",""),
          binned_inc_low = as.numeric(gsub(",","",binned_inc_low,fixed=TRUE)),
          binned_inc_high = as.numeric(gsub(",","",binned_inc_high,fixed=TRUE)),
          median_inc = (binned_inc_high+binned_inc_low)/2,
          pct_no_cov = 100 - pct_public_coverage_alone - pct_private_coverage_alone,
          black_high_ind = case_when(pct_black > 9 ~ "1", TRUE ~ "0"),
          black_high_ind = as.numeric(black_high_ind)) %>% 
  dplyr::select(-binned_inc_high, -binned_inc_low, -contains("coverage"),-pct_no_hs18_24, -pct_hs18_24, -pct_some_col18_24,-pct_hs25_over,-pct_married_households)


num_df <- cancer_df %>% 
  dplyr::select(-county, -state, -median_age_male, -median_age_female,-pct_white,-pct_black,-pct_asian,-pct_other_race) %>% 
  na.omit()
  
```






##stepwise 

```{r results=FALSE}
full_model = lm(target_death_rate ~ ., data = num_df)
summary(full_model)

step_model <- stepAIC(full_model, direction = "both", 
                      trace = FALSE)
summary(step_model)
vif(step_model)
step_model<- update(step_model,.~.-avg_deaths_per_year)
step_model<- update(step_model,.~.-pop_est2015)
step_model<- update(step_model,.~.+black_high_ind*incidence_rate)

```

```{r}
summary(step_model)
vif(step_model)
```

##Backward elimination 
```{r results = FALSE}

back_model <- step(full_model, direction = "backward", trace=FALSE ) 
summary(back_model)
vif(back_model)

```

backward elimination suggest the same with stepwise


##Forward elimination

```{r results = FALSE}
null<- lm(target_death_rate ~ 1, data = num_df)
for_model <- step(null, scope=list(lower=null, upper=full_model), direction="forward")
summary(for_model)
vif(for_model)
for_model<- update(for_model,.~.-avg_deaths_per_year)
for_model<- update(for_model,.~.-pop_est2015)
for_model<- update(for_model,.~.+black_high_ind*incidence_rate)

```

```{r}
summary(for_model)
vif(for_model)
```


https://www.cancer.org/latest-news/facts-and-figures-2018-rate-of-deaths-from-cancer-continues-decline.html

